<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Dashboard | Lost & Found</title>
    <style>
        :root { --orange: #f39c12; --green: #27ae60; --red: #be1e2d; --bg: #0f0f0f; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; padding: 40px; margin: 0; }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
        .user-badge { background: rgba(243, 156, 18, 0.1); padding: 10px 20px; border-radius: 50px; border: 1px solid var(--orange); color: var(--orange); font-weight: bold; }
        
        .section { margin-bottom: 50px; }
        h2 { font-size: 1.5rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; color: #fff; }
        
        .alert-box { background: rgba(39, 174, 96, 0.1); border: 1px solid var(--green); color: var(--green); padding: 15px; border-radius: 12px; margin-bottom: 20px; display: none; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: #1a1a1a; border-radius: 15px; border: 1px solid #333; overflow: hidden; position: relative; }
        .card img { width: 100%; height: 160px; object-fit: cover; background: #222; }
        .card-body { padding: 15px; }
        
        .status-tag { font-size: 10px; text-transform: uppercase; padding: 4px 8px; border-radius: 5px; font-weight: bold; }
        .status-lost { background: var(--red); color: white; }
        .status-found { background: var(--orange); color: white; }

        .nav-btns { display: flex; gap: 10px; }
        .nav-btn { background: #222; color: white; border: 1px solid #444; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-size: 14px; }
        .nav-btn:hover { background: #333; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1 style="margin:0">User Dashboard</h1>
            <p style="color:#777; margin:5px 0 0 0;">Manage your reports and track matches</p>
        </div>
        <div class="nav-btns">
            <a href="loser-gallery.html" class="nav-btn">View All Found</a>
            <div class="user-badge" id="userNameDisplay">User</div>
        </div>
    </div>

    <div id="matchSection" class="section">
        <div class="alert-box" id="matchAlerts">
            <strong>Possible Match Found!</strong> Someone reported an item that matches your description.
        </div>
    </div>

    <div class="section">
        <h2 style="color: var(--red);"><span>üîç</span> My Lost Reports</h2>
        <div class="grid" id="lostGrid"></div>
    </div>

    <div class="section">
        <h2 style="color: var(--orange);"><span>ü§ù</span> My Found Reports</h2>
        <div class="grid" id="foundGrid"></div>
    </div>

    <script>
        function initDashboard() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) { window.location.href = 'login.html'; return; }
            
            document.getElementById('userNameDisplay').innerText = user.name;

            const globalItems = JSON.parse(localStorage.getItem('globalItems')) || [];
            const requestedItems = JSON.parse(localStorage.getItem('requestedItems')) || [];

            // --- Logic 1: Filter My Lost Items ---
            const myLost = requestedItems.filter(it => it.owner === user.name);
            const lostGrid = document.getElementById('lostGrid');
            
            lostGrid.innerHTML = myLost.map(it => `
                <div class="card">
                    ${it.image ? `<img src="${it.image}">` : `<div style="height:160px; background:#222; display:flex; align-items:center; justify-content:center; color:#444">No Image</div>`}
                    <div class="card-body">
                        <span class="status-tag status-lost">Looking For</span>
                        <h3 style="margin:10px 0 5px 0">${it.name}</h3>
                        <p style="font-size:12px; color:#888">Posted: ${it.postDate || 'Recently'}</p>
                    </div>
                </div>
            `).join('') || "<p style='color:#555'>You haven't reported any lost items.</p>";

            // --- Logic 2: Filter My Found Reports ---
            const myFound = globalItems.filter(it => it.founder === user.name);
            const foundGrid = document.getElementById('foundGrid');

            foundGrid.innerHTML = myFound.map(it => `
                <div class="card">
                    ${it.image ? `<img src="${it.image}">` : `<div style="height:160px; background:#222; display:flex; align-items:center; justify-content:center; color:#444">No Image</div>`}
                    <div class="card-body">
                        <span class="status-tag status-found">Found by Me</span>
                        <h3 style="margin:10px 0 5px 0">${it.name}</h3>
                        <p style="font-size:12px; color:#888">At: ${it.location || it.loc}</p>
                    </div>
                </div>
            `).join('') || "<p style='color:#555'>You haven't reported any found items.</p>";

            // --- Logic 3: Match Engine ---
            const matchAlerts = document.getElementById('matchAlerts');
            const matchFound = myLost.some(lostItem => 
                globalItems.some(foundItem => foundItem.name.toLowerCase().includes(lostItem.name.toLowerCase()))
            );

            if (matchFound) {
                matchAlerts.style.display = 'block';
            } else {
                matchAlerts.style.display = 'none';
            }
        }

        // Run on Page Load
        window.onload = initDashboard;

        // SYNC LOGIC: If Admin deletes or updates data in another tab, refresh this dashboard!
        window.addEventListener('storage', (e) => {
            if (e.key === 'requestedItems' || e.key === 'globalItems') {
                initDashboard();
            }
        });
    </script>
</body>
</html>